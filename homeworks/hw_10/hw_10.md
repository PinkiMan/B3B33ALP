# Homework 10

## Zadání

Tento domácí úkol bude ohledně šifrování algoritmem RSA. 
Algoritmus RSA rozlišuje veřejný klíč a soukromý klíč. 
Pro oba klíče je potřeba mít dvě prvočísla p, q, která budou v našem případě “malá”, p<2^20 a q<2^20.

Základem každého klíče je číslo n=p⋅q. Druhé významné číslo pro definici klíčů je hodnota funkce φ(n)=(p−1)(q−1). 
Pro skutečně velká n (čísla o velikosti 2^2048) je pro výpočet funkce φ nutné najít prvočísla p,q, což je v současné době prakticky neřešitelné.

Veřejný klíč je určen dvěma čísly (n,e), kdy pro e platí nsd(e,φ(n))=1 (funkce nsd() značí největšího společného dělitele), tedy čísla e a φ(n) jsou nesoudělná.

Pokud již máme definovaný veřejný klíč, pak soukromý klíč je definován dvěma čísly (n,d), kde d=e−1∈Zφ(n)
. Číslo d lze spočítat pomocí rozšířeného Euklidova algoritmu. 
Rozšířený Euklidův algoritmus při hledání největšího společného dělitele najde i dvě čísla α a β, pro která platí nsd(e,φ(n))=α⋅e+β⋅φ(n). 
I přes to, že čísla α nebo β mohou být záporná, lze je použít k výpočtu d z čísel e a φ(n).

Pokud chce Bob poslat zprávu Alici, tak zprávu zakóduje veřejným klíčem Alice, tedy pomocí dvou čísel (n,e), která Alice zveřejnila. 
Pokud tedy Bob chce zakódovat číslo a, pak s využitím veřejného klíče Alice (n,e) spočte číslo b=ae∈Zn. 
Dešifrování privátním klíčem (n,d) se provede obdobně, pro kód b se spočte číslo c=bd∈Zn. Číslo c je rovno původnímu číslu a.

Tedy pro zakódování čísla a = 1634234218 veřejným klíčem (n=1015282856477,e=914394312011) je potřeba spočítat (1634234218^914394312011)%1015282856477. 
K výpočtu této mocniny je nutné použít algoritmus rychlého mocnění.

Algoritmus pro rozšířený Euklidův algoritmus i algoritmus rychlého mocnění můžete nastudovat třeba v této [kuchařce celých čísel](https://ksp.mff.cuni.cz/kucharky/teorie-cisel/).


### Lehká varianta
- Napište program [sifruj.py](sifruj.py), který jako parametr dostane veřejný klíč Alice, tedy dvě čísla n a e. Dále si program přečte ze standardního vstupu jeden řádek textu a tento text zakóduje následujícím způsobem:
  - ze čtyř po sobě jdoucích znaků 'abcd' textové zprávy vypočtěte číslo x = ( (ord(a)*256 + ord(b))*256 + ord( c ) )*256 + ord(d)
    - pokud by vstupní řetězec neobsahoval 4 znaky, pak se doplní nulovými znaky jejichž hodnota ord je rovna 0
  - na výstup se zapíše šifra čísla x, tedy hodnota (x^e)%n
  - Př.: pro řetězec pes kocka slon se postupně zakódují podslova pes , kock, a sl a on a šifry těchto 4 řetězců se vypíší na výstup
- Vstup programu:
  - sys.argv[1] - obsahuje číslo n z veřejného klíče Alice
  - sys.argv[2] - obsahuje číslo e z veřejného klíče Alice
  - input() - vrátí řetězec, tedy zprávu, kterou máte zašifrovat veřejným klíčem
- Výstup programu:
  - celá čísla oddělená mezerami, každé číslo odpovídá šifře pro 4 znaky vstupní zprávy

Příklady
- Po spuštění programu python3 sifruj.py 1015282856477 914394312011 na standardni vstup:

```
ahoj, jak se mate?
```

vygeneruje výstup:

```
647324878004 696320697151 743669304106 886127950532 29493035087
```

Zdůvodnění: Text ahoj, jak se mate? se převede na čísla 1634234218, 740321889, 1797288805, 544039284, 1698627584, která se veřejným klíčem zašifrují na uvedené kódy.

- Po spuštění programu python3 sifruj.py 940600625927 1031749 na standardni vstup:

```
Uz je to jasnejsi?
```

vygeneruje výstup:

```
220880649389 164682853469 771838036852 276855377185 166690468278
```

Zdůvodnění: Text Uz je to jasnejsi? se převede na čísla 1434067050, 1696625775, 543842675, 1852140147, 1765736448, která se veřejným klíčem zašifrují na uvedené kódy.

- Po spuštění programu python3 sifruj.py 854757130933 339289 na standardni vstup:

```
Slava! Mate to hotove.
```

vygeneruje výstup:

```
237393968415 4435742947 83633252887 427633018709 332159983823 451324201656
```

Zdůvodnění: Text Slava! Mate to hotove. se převede na čísla 1399611766, 1629560909, 1635018016, 1953439848, 1869901686, 1697513472, která se veřejným klíčem zašifrují na uvedené kódy.



### Těžká varianta

- Napište program [attack.py](attack.py), který dostane číslo n z veřejného klíče a zprávu zakódovanou veřejným klíčem Alice. Víte, že číslo e z veřejného klíče Alice je větší než 2^18 a menší než 2^20. Program attack.py dekóduje zprávu a na standardní výstup vypíše tuto dekódovanou zprávu. O vstupní zprávě víte, že obsahuje alespoň jedno z následujících slov:

```
Tento predmet proste nejlepsi genialni
```

- Vstup programu:
  - sys.argv[1] - číslo n z veřejného i privátního klíče Alice
  - input() - zpráva zakódovaná veřejným klíčem Alice
- Výstup programu:
  - dekódovaná zpráva - jeden řádek textu.
- Poznámka:
  - Nejdříve si naprogramujte lehkou úlohu, až budete umět zprávu kódovat, pak obdobným způsobem můžete zprávu dekódovat po výpočtu čísel φ(n), e a d.
  - Pro dekódování je nutné vyzkoušet všechny hodnoty e která jsou větší než 2^18 a menší než 2^20 a pro která platí nsd(e,φ(n))=1

Příklad
- Při spuštění programu python3 attack.py 865149046207
- 
```
352566354542 704277294015 506632666345 494928356066 824421528359 325069048254 839239812833 536096809854 278474205010
```

Výstupem programu bude:

```
Tento predmet je proste genialni!!
```

protože p=932119 a q=928153, pak φ(n)=865147185936 a e=305867 a d=696989570531. Tyto hodnoty jsou použity pro dekódování zprávy.

- Při spuštění programu python3 attack.py 983293323431

```
842181607974 871844623718 433288674900 698725571210 783570923028 327222551412 311846871040 379330380505 84902973359 15529751204
```

Výstupem programu bude:

```
Na ALP je nejlepsi zkusit si nove veci.
```

protože p=1025147 a q=959173, pak φ(n)=983291339112 a e=599311 a d=538813418959. Tyto hodnoty jsou použity pro dekódování zprávy.

- Při spuštění programu python3 attack.py 952371739433

```
727632176438 36244668976 814914613242 835595208469 315384816693 483612417694 400515700122 599076310518 552651231198 183702874860
```

Výstupem programu bude:

```
Bavi vas proste programovat v Pythonu3?
```

protože p=1011817 a q=941249, pak φ(n)=952369786368 a e=766663 a d=247562256631. Tyto hodnoty jsou použity pro dekódování zprávy.








